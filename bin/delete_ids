
require 'httpclient'
require 'zlib'

filename = ARGV[0]

url = 'http://localhost:9033/catalog/update'

client = HTTPClient.new

total = 0
begin
  file = File.open(filename)
  if /\.gz\Z/.match(filename)
    file = Zlib::GzipReader.new(file)
  end

  body = "<delete>"
  file.each do |l|
    body << "<id>#{l.chomp}</id>"
    total += 1
  end
  body << "</delete>"
  if total > 0
    client.post(url, body, {'Content-Type' => 'text/xml'})  
  end
  puts "Deleted #{total} ids from solr\n\n"
rescue Exception => e
  puts "Problem deleting: #{e}"
end
    
